<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Implementation of the iroh-gossip protocol, as an IO-less state machine"><title>iroh::gossip::proto - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-b21aa549bf6d91ff.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="iroh" data-themes="" data-resource-suffix="" data-rustdoc-version="1.80.0-nightly (c987ad527 2024-05-01)" data-channel="nightly" data-search-js="search-bf21c90c8c1d92b1.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../../static.files/storage-e32f0c247825364d.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-09095024cf37855e.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../iroh/index.html">iroh</a><span class="version">0.26.0</span></h2></div><h2 class="location"><a href="#">Module proto</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li></ul></section><h2><a href="../index.html">In iroh::gossip</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../../../iroh/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Type ‘S’ or ‘/’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../../../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings">Settings</a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../../index.html">iroh</a>::<wbr><a href="../index.html">gossip</a>::<wbr><a class="mod" href="#">proto</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../../src/iroh_gossip/lib.rs.html#13">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Implementation of the iroh-gossip protocol, as an IO-less state machine</p>
<p>This module implements the iroh-gossip protocol. The entry point is <a href="struct.State.html" title="struct iroh::gossip::proto::State"><code>State</code></a>, which contains
the protocol state for a node.</p>
<p>The iroh-gossip protocol is made up from two parts: A swarm membership protocol, based on
<a href="https://asc.di.fct.unl.pt/~jleitao/pdf/dsn07-leitao.pdf">HyParView</a>, and a gossip broadcasting protocol, based on <a href="https://asc.di.fct.unl.pt/~jleitao/pdf/srds07-leitao.pdf">PlumTree</a>.</p>
<p>For a full explanation it is recommended to read the two papers. What follows is a brief
outline of the protocols.</p>
<p>All protocol messages are namespaced by a <a href="struct.TopicId.html" title="struct iroh::gossip::proto::TopicId"><code>TopicId</code></a>, a 32 byte identifier. Topics are
separate swarms and broadcast scopes. The HyParView and PlumTree algorithms both work in the
scope of a single topic. Thus, joining multiple topics increases the number of open connections
to peers and the size of the local routing table.</p>
<p>The <strong>membership protocol</strong> (<a href="https://asc.di.fct.unl.pt/~jleitao/pdf/dsn07-leitao.pdf">HyParView</a>) is a cluster protocol where each peer
maintains a partial view of all nodes in the swarm.
A peer joins the swarm for a topic by connecting to any known peer that is a member of this
topic’s swarm. Obtaining this initial contact info happens out of band. The peer then sends
a <code>Join</code> message to that initial peer. All peers maintain a list of
<code>active</code> and <code>passive</code> peers. Active peers are those that you maintain active connections to.
Passive peers is an addressbook of additional peers. If one of your active peers goes offline,
its slot is filled with a random peer from the passive set. In the default configuration, the
active view has a size of 5 and the passive view a size of 30.
The HyParView protocol ensures that active connections are always bidirectional, and regularly
exchanges nodes for the passive view in a <code>Shuffle</code> operation.
Thus, this protocol exposes a high degree of reliability and auto-recovery in the case of node
failures.</p>
<p>The <strong>gossip protocol</strong> (<a href="https://asc.di.fct.unl.pt/~jleitao/pdf/srds07-leitao.pdf">PlumTree</a>) builds upon the membership protocol. It exposes
a method to broadcast messages to all peers in the swarm. On each node, it maintains two sets
of peers: An <code>eager</code> set and a <code>lazy</code> set. Both are subsets of the <code>active</code> view from the
membership protocol. When broadcasting a message from the local node, or upon receiving a
broadcast message, the message is pushed to all peers in the eager set. Additionally, the hash
of the message (which uniquely identifies it), but not the message content, is lazily pushed
to all peers  in the <code>lazy</code> set. When receiving such lazy pushes (called <code>Ihaves</code>), those peers
may request the message content after a timeout if they didn’t receive the message by one of
their eager peers before. When requesting a message from a currently-lazy peer, this peer is
also upgraded to be an eager peer from that moment on. This strategy self-optimizes the
messaging graph by latency. Note however that this optimization will work best if the messaging
paths are stable, i.e. if it’s always the same peer that broadcasts. If not, the relative
message redundancy will grow and the ideal messaging graph might change frequently.</p>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="state/index.html" title="mod iroh::gossip::proto::state">state</a></div><div class="desc docblock-short">The protocol state of the <code>iroh-gossip</code> protocol.</div></li><li><div class="item-name"><a class="mod" href="topic/index.html" title="mod iroh::gossip::proto::topic">topic</a></div><div class="desc docblock-short">This module contains the implementation of the gossiping protocol for an individual topic</div></li><li><div class="item-name"><a class="mod" href="util/index.html" title="mod iroh::gossip::proto::util">util</a></div><div class="desc docblock-short">Utilities used in the protocol implementation</div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Config.html" title="struct iroh::gossip::proto::Config">Config</a></div><div class="desc docblock-short">Protocol configuration</div></li><li><div class="item-name"><a class="struct" href="struct.Message.html" title="struct iroh::gossip::proto::Message">Message</a></div><div class="desc docblock-short">Protocol wire message</div></li><li><div class="item-name"><a class="struct" href="struct.PeerData.html" title="struct iroh::gossip::proto::PeerData">PeerData</a></div><div class="desc docblock-short">Opaque binary data that is transmitted on messages that introduce new peers.</div></li><li><div class="item-name"><a class="struct" href="struct.State.html" title="struct iroh::gossip::proto::State">State</a></div><div class="desc docblock-short">The state of the <code>iroh-gossip</code> protocol.</div></li><li><div class="item-name"><a class="struct" href="struct.Timer.html" title="struct iroh::gossip::proto::Timer">Timer</a></div><div class="desc docblock-short">A timer to be registered into the runtime</div></li><li><div class="item-name"><a class="struct" href="struct.TopicId.html" title="struct iroh::gossip::proto::TopicId">TopicId</a></div><div class="desc docblock-short">The identifier for a topic</div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.Command.html" title="enum iroh::gossip::proto::Command">Command</a></div><div class="desc docblock-short">A command to the protocol state for a particular topic.</div></li><li><div class="item-name"><a class="enum" href="enum.DeliveryScope.html" title="enum iroh::gossip::proto::DeliveryScope">DeliveryScope</a></div><div class="desc docblock-short">The scope to deliver the message to.</div></li><li><div class="item-name"><a class="enum" href="enum.Event.html" title="enum iroh::gossip::proto::Event">Event</a></div><div class="desc docblock-short">An event to be emitted to the application for a particular topic.</div></li><li><div class="item-name"><a class="enum" href="enum.InEvent.html" title="enum iroh::gossip::proto::InEvent">InEvent</a></div><div class="desc docblock-short">Input event to the protocol state.</div></li><li><div class="item-name"><a class="enum" href="enum.OutEvent.html" title="enum iroh::gossip::proto::OutEvent">OutEvent</a></div><div class="desc docblock-short">Output event from the protocol state.</div></li><li><div class="item-name"><a class="enum" href="enum.Scope.html" title="enum iroh::gossip::proto::Scope">Scope</a></div><div class="desc docblock-short">The broadcast scope of a gossip message.</div></li></ul><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.IO.html" title="trait iroh::gossip::proto::IO">IO</a></div><div class="desc docblock-short">A trait for a concrete type to push <code>OutEvent</code>s to.</div></li><li><div class="item-name"><a class="trait" href="trait.PeerIdentity.html" title="trait iroh::gossip::proto::PeerIdentity">PeerIdentity</a></div><div class="desc docblock-short">The identifier for a peer.</div></li></ul></section></div></main></body></html>