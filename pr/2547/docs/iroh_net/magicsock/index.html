<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Implements a socket that can change its communication path while in use, actively searching for the best way to communicate."><title>iroh_net::magicsock - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-b21aa549bf6d91ff.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="iroh_net" data-themes="" data-resource-suffix="" data-rustdoc-version="1.80.0-nightly (c987ad527 2024-05-01)" data-channel="nightly" data-search-js="search-bf21c90c8c1d92b1.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-e32f0c247825364d.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-09095024cf37855e.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../iroh_net/index.html">iroh_net</a><span class="version">0.21.0</span></h2></div><h2 class="location"><a href="#">Module magicsock</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#reexports">Re-exports</a></li><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li><li><a href="#statics">Statics</a></li><li><a href="#functions">Functions</a></li><li><a href="#types">Type Aliases</a></li></ul></section><h2><a href="../index.html">In crate iroh_net</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../../iroh_net/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Type â€˜Sâ€™ or â€˜/â€™ to search, â€˜?â€™ for more optionsâ€¦" type="search"><div id="help-button" tabindex="-1"><a href="../../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings">Settings</a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">iroh_net</a>::<wbr><a class="mod" href="#">magicsock</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../src/iroh_net/magicsock.rs.html#1-3538">source</a> Â· <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Implements a socket that can change its communication path while in use, actively searching for the best way to communicate.</p>
<p>Based on tailscale/wgengine/magicsock</p>
<h4 id="dev_relay_only-env-var"><a class="doc-anchor" href="#dev_relay_only-env-var">Â§</a><code>DEV_RELAY_ONLY</code> env var:</h4>
<p>When present at <em>compile time</em>, this env var will force all packets
to be sent over the relay connection, regardless of whether or
not we have a direct UDP address for the given node.</p>
<p>The intended use is for testing the relay protocol inside the MagicSock
to ensure that we can rely on the relay to send packets when two nodes
are unable to find direct UDP connections to each other.</p>
<p>This also prevent this node from attempting to hole punch and prevents it
from responding to any hole punching attempts. This node will still,
however, read any packets that come off the UDP sockets.</p>
</div></details><h2 id="reexports" class="section-header">Re-exports<a href="#reexports" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name" id="reexport.Metrics"><code>pub use self::metrics::<a class="struct" href="metrics/struct.Metrics.html" title="struct iroh_net::magicsock::metrics::Metrics">Metrics</a>;</code></div></li><li><div class="item-name" id="reexport.ConnectionType"><code>pub use self::node_map::<a class="enum" href="../endpoint/enum.ConnectionType.html" title="enum iroh_net::endpoint::ConnectionType">ConnectionType</a>;</code></div></li><li><div class="item-name" id="reexport.ConnectionTypeStream"><code>pub use self::node_map::<a class="struct" href="../endpoint/struct.ConnectionTypeStream.html" title="struct iroh_net::endpoint::ConnectionTypeStream">ConnectionTypeStream</a>;</code></div></li><li><div class="item-name" id="reexport.ControlMsg"><code>pub use self::node_map::<a class="enum" href="../endpoint/enum.ControlMsg.html" title="enum iroh_net::endpoint::ControlMsg">ControlMsg</a>;</code></div></li><li><div class="item-name" id="reexport.DirectAddrInfo"><code>pub use self::node_map::<a class="struct" href="../endpoint/struct.DirectAddrInfo.html" title="struct iroh_net::endpoint::DirectAddrInfo">DirectAddrInfo</a>;</code></div></li><li><div class="item-name" id="reexport.ConnectionInfo"><code>pub use self::node_map::<a class="struct" href="../endpoint/struct.ConnectionInfo.html" title="struct iroh_net::endpoint::ConnectionInfo">NodeInfo</a> as ConnectionInfo;</code></div></li></ul><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="metrics/index.html" title="mod iroh_net::magicsock::metrics">metrics</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="mod" href="node_map/index.html" title="mod iroh_net::magicsock::node_map">node_map</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="mod" href="relay_actor/index.html" title="mod iroh_net::magicsock::relay_actor">relay_actor</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="mod" href="timer/index.html" title="mod iroh_net::magicsock::timer">timer</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="mod" href="udp_conn/index.html" title="mod iroh_net::magicsock::udp_conn">udp_conn</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Actor.html" title="struct iroh_net::magicsock::Actor">Actor</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="struct" href="struct.DirectAddr.html" title="struct iroh_net::magicsock::DirectAddr">DirectAddr</a></div><div class="desc docblock-short">A <em>direct address</em> on which an iroh-node might be contactable.</div></li><li><div class="item-name"><a class="struct" href="struct.DirectAddrUpdateState.html" title="struct iroh_net::magicsock::DirectAddrUpdateState">DirectAddrUpdateState</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Manages currently running direct addr discovery, aka netcheck runs.</div></li><li><div class="item-name"><a class="struct" href="struct.DirectAddrsStream.html" title="struct iroh_net::magicsock::DirectAddrsStream">DirectAddrsStream</a></div><div class="desc docblock-short">Stream returning local endpoints as they change.</div></li><li><div class="item-name"><a class="struct" href="struct.DiscoSecrets.html" title="struct iroh_net::magicsock::DiscoSecrets">DiscoSecrets</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="struct" href="struct.DiscoveredDirectAddrs.html" title="struct iroh_net::magicsock::DiscoveredDirectAddrs">DiscoveredDirectAddrs</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">The discovered direct addresses of this <a href="struct.MagicSock.html" title="struct iroh_net::magicsock::MagicSock"><code>MagicSock</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.Handle.html" title="struct iroh_net::magicsock::Handle">Handle</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Handle for <a href="struct.MagicSock.html" title="struct iroh_net::magicsock::MagicSock"><code>MagicSock</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.MagicSock.html" title="struct iroh_net::magicsock::MagicSock">MagicSock</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Iroh connectivity layer.</div></li><li><div class="item-name"><a class="struct" href="struct.NetInfo.html" title="struct iroh_net::magicsock::NetInfo">NetInfo</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Contains information about the hostâ€™s network state.</div></li><li><div class="item-name"><a class="struct" href="struct.Options.html" title="struct iroh_net::magicsock::Options">Options</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Contains options for <code>MagicSock::listen</code>.</div></li><li><div class="item-name"><a class="struct" href="struct.PacketSplitIter.html" title="struct iroh_net::magicsock::PacketSplitIter">PacketSplitIter</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Splits a packet into its component items.</div></li><li><div class="item-name"><a class="struct" href="struct.QuicMappedAddr.html" title="struct iroh_net::magicsock::QuicMappedAddr">QuicMappedAddr</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">The fake address used by the QUIC layer to address a node.</div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.ActorMessage.html" title="enum iroh_net::magicsock::ActorMessage">ActorMessage</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="enum" href="enum.DirectAddrType.html" title="enum iroh_net::magicsock::DirectAddrType">DirectAddrType</a></div><div class="desc docblock-short">The type of direct address.</div></li><li><div class="item-name"><a class="enum" href="enum.DiscoBoxError.html" title="enum iroh_net::magicsock::DiscoBoxError">DiscoBoxError</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="enum" href="enum.DiscoMessageSource.html" title="enum iroh_net::magicsock::DiscoMessageSource">DiscoMessageSource</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li></ul><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.ENDPOINTS_FRESH_ENOUGH_DURATION.html" title="constant iroh_net::magicsock::ENDPOINTS_FRESH_ENOUGH_DURATION">ENDPOINTS_FRESH_ENOUGH_DURATION</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">How long we consider a STUN-derived endpoint valid for. UDP NAT mappings typically
expire at 30 seconds, so this is a few seconds shy of that.</div></li><li><div class="item-name"><a class="constant" href="constant.HEARTBEAT_INTERVAL.html" title="constant iroh_net::magicsock::HEARTBEAT_INTERVAL">HEARTBEAT_INTERVAL</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="constant" href="constant.NETCHECK_REPORT_TIMEOUT.html" title="constant iroh_net::magicsock::NETCHECK_REPORT_TIMEOUT">NETCHECK_REPORT_TIMEOUT</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Maximum duration to wait for a netcheck report.</div></li></ul><h2 id="statics" class="section-header">Statics<a href="#statics" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="static" href="static.ADDR_COUNTER.html" title="static iroh_net::magicsock::ADDR_COUNTER">ADDR_COUNTER</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Counter to always generate unique addresses for <a href="struct.QuicMappedAddr.html" title="struct iroh_net::magicsock::QuicMappedAddr"><code>QuicMappedAddr</code></a>.</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.bind.html" title="fn iroh_net::magicsock::bind">bind</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Initial connection setup.</div></li><li><div class="item-name"><a class="fn" href="fn.disco_message_sent.html" title="fn iroh_net::magicsock::disco_message_sent">disco_message_sent</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.endpoint_sets_equal.html" title="fn iroh_net::magicsock::endpoint_sets_equal">endpoint_sets_equal</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Reports whether x and y represent the same set of endpoints. The order doesnâ€™t matter.</div></li><li><div class="item-name"><a class="fn" href="fn.new_re_stun_timer.html" title="fn iroh_net::magicsock::new_re_stun_timer">new_re_stun_timer</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.split_packets.html" title="fn iroh_net::magicsock::split_packets">split_packets</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Split a number of transmits into individual packets.</div></li></ul><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="type" href="type.RelayContents.html" title="type iroh_net::magicsock::RelayContents">RelayContents</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Contents of a relay message. Use a SmallVec to avoid allocations for the very
common case of a single packet.</div></li><li><div class="item-name"><a class="type" href="type.RelayRecvResult.html" title="type iroh_net::magicsock::RelayRecvResult">RelayRecvResult</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li></ul></section></div></main></body></html>